<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="author" content="Stan Rozenraukh" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Building view-trees: The basics [Part 2] - stanistan</title>
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.stanistan.com/rss.xml">
        
        <link rel="icon" href="data:" />
        
            
            <style type="text/css">body{border-top:5px solid #f6cde0;background:#fcfcfc;color:#333;font-family:Cochin,Times,serif;font-size:1.3em;line-height:1.42;margin:0;padding:0;-webkit-font-smoothing:subpixel-antialiased}.content{margin:8em auto 0;max-width:33em;padding:2em;position:relative}.content.resume{margin:1em auto 0;max-width:35em}article{position:relative}h1{font-size:1.4em;font-weight:800;color:#262626;font-family:monospace;margin:0;padding:1.4em 0 0}h1+p{margin-top:0}h2{font-size:1.2em;font-weight:800;color:#262626;font-family:monospace;margin:0;padding:1.2em 0 0}h2+p{margin-top:0}h3{font-size:1.12em;font-weight:800;color:#262626;font-family:monospace;margin:0;padding:1.12em 0 0}h3+p{margin-top:0}h4{font-size:1em;font-weight:800;color:#262626;font-family:monospace;margin:0;padding:1em 0 0}h4+p{margin-top:0}hr{border:0 dotted #f6cde0;border-top-width:1px;height:0}pre,.mono,code{font-family:monospace}.small{font-size:75%}.smaller{font-size:85%}.faded{color:#999}.center{text-align:center}a,.link-like{color:#000193;font-weight:bolder;text-underline-offset:6px}a:hover,.link-like:hover{color:#1415ff;text-decoration:none}a:active,.link-like:active{color:red}ol,ul{list-style-position:outside;margin:0;margin-left:1.6em;padding:0}ol li,ul li{margin:0 0 .1em 0;padding:0 0 0 .2em}.outside{margin-left:-2em}ul.outside,ol.outside{margin-left:-.1em}.posts-list li{margin-bottom:.2em}.posts-list .date-written{margin-top:4px}.posts-list a{text-underline-offset:2px;text-decoration-color:#0001c6;text-decoration-thickness:.5px}code{background:#fdf4f8;border-bottom:1px dotted #f6cde0;padding:.3em;font-size:.85em}pre,blockquote{background:#fff;line-height:1.45em;margin-left:-2em;margin-right:-2em}pre{font-size:.85em;border-bottom:1px dotted #f6cde0;padding:1em 2em;overflow-x:scroll}pre code{background:inherit;border-bottom:0;padding:0;font-size:inherit}blockquote{font-size:.9em;font-style:italic;padding:.5em 2em;border-left:1px dotted #f6cde0}.tag{margin-right:.3em;border-radius:10px;color:#333;text-decoration:none}.tag:hover{color:#000;text-decoration:underline}.toc{margin:.2em -2em 0;padding:2em;font-size:.7em;line-height:1.45;border-bottom:1px dotted #f6cde0}.toc a{color:#333;font-weight:normal}.toc ul{list-style:none;margin-left:0em}.toc ul ul{margin-left:1em}.anchor-link{position:absolute;margin-left:-.9em;text-decoration:none;font-weight:normal}article .img-container{margin:.2em -2em 0}article .img-container img{width:100%;height:auto}@media only screen and (max-width: 500px){body{font-size:1.15em}.content{padding:1.8em}.smaller{font-size:90%}.small{font-size:83%}.outside{margin-left:inherit}article .img-container{margin:.2em -1em 0}}dl{margin:1.5em 0}dl dt{clear:left;float:left;text-decoration:underline;text-align:right;width:5.5em}dl dt::after{content:":"}dl dd{display:block;float:left}.clear{clear:both}.invoice-heading{padding:1.5em 0}.invoice-heading h1{float:left;padding:0}.invoice-heading .invoice-heading-code{float:right;font-weight:bold}table{margin-top:1em;margin-bottom:1em;width:100%}table th,table td{text-align:left}table th.right,table td.right{text-align:right}table th{font-size:75%}table tfoot td{font-weight:bold}table tfoot tr:first-child td{border-top:1px dotted #f6cde0;padding-top:.3em}table tbody tr:last-child td{padding-bottom:.3em}table tbody tr:first-child td{padding-top:.3em}table thead tr:last-child th{padding-bottom:.3em;border-bottom:1px dotted #ccc}table tr{width:100%}details{font-size:85%}details summary{font-weight:bold;color:#00002d}details summary:hover{color:#1415ff;cursor:pointer}.job{margin:10px 0 10px -20px;padding:0px 20px 40px 40px;background:#fef8fb}.job .place{margin-left:-20px}.job .position+.position{margin-top:1em}.job .position h3{font-size:93%;font-weight:bold;padding-top:.7em}.job .position h4.when{font-size:70%;font-weight:normal;padding-top:0;line-height:1.1em}.job .position .details{max-width:55em;margin-top:1em;font-size:88%;line-height:1.3em}.job .position .details li+li{margin-top:10px}</style>
        
    </head>
    <body>
        <div class="content ">
            
    <a href="/" class="faded mono small" title="stanistan /">go /</a>
    <article>
        <h1>Building view-trees: The basics [Part 2]</h1>
        <div class="small faded">
            
    
    
    
    <a href="https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;stanistan&#x2F;stanistan.github.io&#x2F;the-details&#x2F;content&#x2F;writes&#x2F;building-view-trees-in-go-part-2.md" class="faded">.md</a>
 |
            <a href="https://www.stanistan.com/writes/building-view-trees-in-go-part-2/" class="faded">permalink</a>
            
            | Published on December 04, 2023
            
        </div>

        

        

        <section class="post">
            <p>We laid our goals in the <a href="/writes/building-view-trees-in-go-part-1">part 1</a>.</p>
<hr />
<h1 id="let-s-make-something-renderable">Let's make something renderable</h1>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">import </span><span style="color:#183691;">&quot;html/template&quot;
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">type </span><span>RenderFunc </span><span style="font-weight:bold;color:#a71d5d;">func</span><span>(r </span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>) (template.</span><span style="font-weight:bold;color:#a71d5d;">HTML</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>)
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">type </span><span>Renderable </span><span style="font-weight:bold;color:#a71d5d;">interface </span><span>{
</span><span>    </span><span style="font-weight:bold;color:#795da3;">Template</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>)
</span><span>    </span><span style="font-weight:bold;color:#795da3;">TemplateData</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">any</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>)
</span><span>}
</span></code></pre>
<p>Let's start with interfaces and type definitions of the concepts:</p>
<ol>
<li>We want to be able to <code>Render</code> a <code>Renderable</code> struct into HTML,
this can fail.</li>
<li>We also want the Renderable thing to give us all of the information
it needs so we can render it. This can also fail.</li>
</ol>
<p>This interface is small, let's see how far we can push this.</p>
<h2 id="first-implementation">First Implementation</h2>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">func </span><span style="font-weight:bold;color:#795da3;">Render</span><span>(r </span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>) (template.</span><span style="font-weight:bold;color:#a71d5d;">HTML</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">var </span><span>empty template.</span><span style="font-weight:bold;color:#a71d5d;">HTML
</span><span>
</span><span>    tpl, err </span><span style="font-weight:bold;color:#a71d5d;">:= </span><span>r.Template()
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span>err </span><span style="font-weight:bold;color:#a71d5d;">!= </span><span style="color:#0086b3;">nil </span><span>{
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>empty, err
</span><span>    }
</span><span>
</span><span>    data, err </span><span style="font-weight:bold;color:#a71d5d;">:= </span><span>r.TemplateData()
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span>err </span><span style="font-weight:bold;color:#a71d5d;">!= </span><span style="color:#0086b3;">nil </span><span>{
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>empty, err
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">var </span><span>bs bytes.</span><span style="font-weight:bold;color:#a71d5d;">Buffer
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span>err </span><span style="font-weight:bold;color:#a71d5d;">:= </span><span>tpl.Execute(</span><span style="font-weight:bold;color:#a71d5d;">&amp;</span><span>bs, data); err </span><span style="font-weight:bold;color:#a71d5d;">!= </span><span style="color:#0086b3;">nil </span><span>{
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>empty, err
</span><span>    }
</span><span>
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.HTML(bs.String()), </span><span style="color:#0086b3;">nil
</span><span>}
</span></code></pre>
<p>The implementation is small, too, but what good are components
if you can't compose them.</p>
<h3 id="patches">Patches</h3>










<div>
  <details>
    <summary class="small">
      Initial Renderer implementation
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;90edfc07f2585860932c24a2619b3977c933fd6a">(source: 90edfc07)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/renderer.go b/renderer.go
</span><span>new file mode 100644
</span><span>index 0000000..c96d89d
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/renderer.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,39 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">package veun
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">import (
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;bytes&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;fmt&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;html/template&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type RenderFunc func(r Renderable) (template.HTML, error)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type Renderable interface {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Template() (*template.Template, error)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	TemplateData() (any, error)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func Render(r Renderable) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	var empty template.HTML
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	tpl, err := r.Template()
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	if err != nil {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		return empty, err
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	if tpl == nil {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		return empty, fmt.Errorf(&quot;missing template&quot;)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	data, err := r.TemplateData()
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	if err != nil {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		return empty, err
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	var bs bytes.Buffer
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	if err := tpl.Execute(&amp;bs, data); err != nil {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		return empty, err
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return template.HTML(bs.String()), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span>
</span></code></pre>


  </details>
</div>










<div>
  <details>
    <summary class="small">
      Initial test for rendering PersonView(Person...)
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;23ca88bbcdc25dce2036dec8295720abc26e6cec">(source: 23ca88bb)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/go.mod b/go.mod
</span><span>index 09551ac..ec2216f 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/go.mod
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/go.mod
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -1,3 +1,9 @@
</span><span> module github.com/stanistan/veun
</span><span> 
</span><span> go 1.21.4
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">require (
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	github.com/alecthomas/assert/v2 v2.4.0 // indirect
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	github.com/alecthomas/repr v0.3.0 // indirect
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	github.com/hexops/gotextdiff v1.0.3 // indirect
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span>diff --git a/go.sum b/go.sum
</span><span>new file mode 100644
</span><span>index 0000000..bb218ed
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/go.sum
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,6 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">github.com/alecthomas/assert/v2 v2.4.0 h1:/ZiZ0NnriAWPYYO+4eOjgzNELrFQLaHNr92mHSHFj9U=
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">github.com/alecthomas/assert/v2 v2.4.0/go.mod h1:fw5suVxB+wfYJ3291t0hRTqtGzFYdSwstnRQdaQx2DM=
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">github.com/alecthomas/repr v0.3.0 h1:NeYzUPfjjlqHY4KtzgKJiWd6sVq2eNUPTi34PiFGjY8=
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">github.com/alecthomas/repr v0.3.0/go.mod h1:Fr0507jx4eOXV7AlPV6AVZLYrLIuIeSOWtW57eE/O/4=
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">github.com/hexops/gotextdiff v1.0.3 h1:gitA9+qJrrTCsiCl7+kh75nPqQt1cx4ZkudSTLoUqJM=
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">github.com/hexops/gotextdiff v1.0.3/go.mod h1:pSWU5MAI3yDq+fZBTazCSJysOMbxWL1BSow5/V2vxeg=
</span><span>diff --git a/render_person_test.go b/render_person_test.go
</span><span>new file mode 100644
</span><span>index 0000000..64a542b
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_person_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,41 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">package veun_test
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">import (
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;html/template&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;testing&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;github.com/alecthomas/assert/v2&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;github.com/stanistan/veun&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type Person struct {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Name string
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type personView struct {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Person Person
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func PersonView(person Person) *personView {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return &amp;personView{Person: person}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">var _ veun.Renderable = &amp;personView{}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">var personViewTpl = template.Must(
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	template.New(&quot;PersonView&quot;).Parse(`&lt;div&gt;Hi, {{ .Name }}.&lt;/div&gt;`),
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v *personView) Template() (*template.Template, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return personViewTpl, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v *personView) TemplateData() (any, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v.Person, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func TestRenderPerson(t *testing.T) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	html, err := veun.Render(PersonView(Person{Name: &quot;Stan&quot;}))
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	assert.NoError(t, err)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	assert.Equal(t, html, template.HTML(`&lt;div&gt;Hi, Stan.&lt;/div&gt;`))
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span>
</span></code></pre>


  </details>
</div>
<h1 id="trees-and-subviews">Trees and Subviews</h1>
<p>In order to bring the component into our tree composition view library,
we need to have <code>Renderable</code> objects have subtrees.</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span>_, _ </span><span style="font-weight:bold;color:#a71d5d;">:= </span><span>Render(ContainerView{
</span><span>    Heading: ChildView1{},
</span><span>    Body:    ChildView2{},
</span><span>})
</span></code></pre>
<pre data-lang="mustache" style="background-color:#ffffff;color:#323232;" class="language-mustache "><code class="language-mustache" data-lang="mustache"><span>&lt;</span><span style="color:#63a35c;">div</span><span>&gt;
</span><span>    &lt;</span><span style="color:#63a35c;">div </span><span style="color:#795da3;">class=</span><span style="color:#183691;">&quot;heading&quot;</span><span>&gt;</span><span style="color:#0086b3;">{{ </span><span>slot </span><span style="color:#183691;">&quot;heading&quot; </span><span style="color:#0086b3;">}}</span><span>&lt;/</span><span style="color:#63a35c;">div</span><span>&gt;
</span><span>    &lt;</span><span style="color:#63a35c;">div </span><span style="color:#795da3;">class=</span><span style="color:#183691;">&quot;body&quot;</span><span>&gt;</span><span style="color:#0086b3;">{{ </span><span>slot </span><span style="color:#183691;">&quot;body&quot; </span><span style="color:#0086b3;">}}</span><span>&lt;/</span><span style="color:#63a35c;">div</span><span>&gt;
</span><span>&lt;/</span><span style="color:#63a35c;">div</span><span>&gt;
</span></code></pre>
<h2 id="the-poc">The POC</h2>
<p>The basic idea is to leverage <code>template.FuncMap</code> to create a
<code>slot</code> function.</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">func </span><span>(v </span><span style="font-weight:bold;color:#a71d5d;">ContainerView</span><span>) </span><span style="font-weight:bold;color:#795da3;">Template</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.New(</span><span style="color:#183691;">&quot;containerView&quot;</span><span>).Funcs(template.FuncMap{
</span><span>        </span><span style="color:#183691;">&quot;slot&quot;</span><span>: </span><span style="font-weight:bold;color:#a71d5d;">func</span><span>(name </span><span style="font-weight:bold;color:#0086b3;">string</span><span>) (template.</span><span style="font-weight:bold;color:#a71d5d;">HTML</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">switch </span><span>name {
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">case </span><span style="color:#183691;">&quot;heading&quot;</span><span>:
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>Render(v.Heading)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">case </span><span style="color:#183691;">&quot;body&quot;</span><span>:
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>Render(v.Body)
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">default</span><span>:
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.HTML(</span><span style="color:#183691;">&quot;&quot;</span><span>), </span><span style="color:#0086b3;">nil
</span><span>            }
</span><span>        },
</span><span>    }).Parse(</span><span style="color:#183691;">`&lt;div&gt;
</span><span style="color:#183691;">    &lt;div class=&quot;heading&quot;&gt;</span><span>{{ slot </span><span style="color:#183691;">&quot;heading&quot; </span><span>}}</span><span style="color:#183691;">&lt;/div&gt;
</span><span style="color:#183691;">    &lt;div class=&quot;body&quot;&gt;</span><span>{{ slot </span><span style="color:#183691;">&quot;body&quot; </span><span>}}</span><span style="color:#183691;">&lt;/div&gt;
</span><span style="color:#183691;">&lt;/div&gt;`</span><span>)
</span><span>}
</span></code></pre>










<div>
  <details>
    <summary class="small">
      test for v1 of composition
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;40fb4895f4da3511b61334414de612417cd2932f">(source: 40fb4895)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/render_container_test.go b/render_container_test.go
</span><span>new file mode 100644
</span><span>index 0000000..951acb3
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,73 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">package veun_test
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">import (
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;html/template&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;testing&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;github.com/alecthomas/assert/v2&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	. &quot;github.com/stanistan/veun&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type ContainerView struct {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Heading Renderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Body    Renderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ContainerView) Template() (*template.Template, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return template.New(&quot;containerView&quot;).Funcs(template.FuncMap{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			switch name {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			case &quot;heading&quot;:
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">				return Render(v.Heading)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			case &quot;body&quot;:
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">				return Render(v.Body)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			default:
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">				return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}).Parse(`&lt;div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;heading&quot;&gt;{{ slot &quot;heading&quot; }}&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;body&quot;&gt;{{ slot &quot;body&quot; }}&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">&lt;/div&gt;`)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ContainerView) TemplateData() (any, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return nil, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">var childViewTemplate = template.Must(
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	template.New(&quot;childView&quot;).Parse(`{{ . }}`),
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type ChildView1 struct{}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ChildView1) Template() (*template.Template, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return childViewTemplate, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ChildView1) TemplateData() (any, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return &quot;HEADING&quot;, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type ChildView2 struct{}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ChildView2) Template() (*template.Template, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return childViewTemplate, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ChildView2) TemplateData() (any, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return &quot;BODY&quot;, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func TestRenderContainer(t *testing.T) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	html, err := Render(&amp;ContainerView{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Heading: ChildView1{},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Body:    ChildView2{},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	})
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	assert.NoError(t, err)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	assert.Equal(t, template.HTML(`&lt;div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;heading&quot;&gt;HEADING&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;body&quot;&gt;BODY&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">&lt;/div&gt;`), html)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span>
</span></code></pre>


  </details>
</div>
<h3 id="alternate-approach">Alternate approach</h3>
<p>Alternatively, we can directly inline the fields in the data so our template
looks more like this:</p>
<pre data-lang="mustache" style="background-color:#ffffff;color:#323232;" class="language-mustache "><code class="language-mustache" data-lang="mustache"><span>&lt;</span><span style="color:#63a35c;">div </span><span style="color:#795da3;">class=</span><span style="color:#183691;">&quot;heading&quot;</span><span>&gt;</span><span style="color:#0086b3;">{{ </span><span>render .Slots.Heading </span><span style="color:#0086b3;">}}</span><span>&lt;/</span><span style="color:#63a35c;">div</span><span>&gt;
</span></code></pre>
<h2 id="template-compilation">Template compilation</h2>
<p><em>Refactor 1</em>: Making it so that we can do pre-compilation of the template,
we can pre-parse it. The immediate issue is that we don't have slots,
and the slot func is necessary to compile the tempalte. We can stub that out:</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">func </span><span style="font-weight:bold;color:#795da3;">slotFuncStub</span><span>(name </span><span style="font-weight:bold;color:#0086b3;">string</span><span>) (template.</span><span style="font-weight:bold;color:#a71d5d;">HTML</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.HTML(</span><span style="color:#183691;">&quot;&quot;</span><span>), </span><span style="color:#0086b3;">nil
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">func </span><span style="font-weight:bold;color:#795da3;">mustParseTemplate</span><span>(name, contents </span><span style="font-weight:bold;color:#0086b3;">string</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template </span><span>{
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.Must(
</span><span>        template.New(name).
</span><span>        Funcs(template.FuncMap{</span><span style="color:#183691;">&quot;slot&quot;</span><span>: slotFuncStub}).
</span><span>        Parse(contents),
</span><span>    )
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">var </span><span>containerViewTpl </span><span style="font-weight:bold;color:#a71d5d;">= </span><span>mustParseTemplate(</span><span style="color:#183691;">&quot;containerView&quot;</span><span>, </span><span style="color:#183691;">`&lt;div&gt;
</span><span style="color:#183691;">    &lt;div class=&quot;heading&quot;&gt;</span><span>{{ slot </span><span style="color:#183691;">&quot;heading&quot; </span><span>}}</span><span style="color:#183691;">&lt;/div&gt;
</span><span style="color:#183691;">    &lt;div class=&quot;body&quot;&gt;</span><span>{{ slot </span><span style="color:#183691;">&quot;body&quot; </span><span>}}</span><span style="color:#183691;">&lt;/div&gt;
</span><span style="color:#183691;">&lt;/div&gt;`</span><span>)
</span></code></pre>
<p>And then update our <code>Template()</code> function:</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span>containerViewTpl.Funcs(template.FuncMap{
</span><span>    </span><span style="color:#183691;">&quot;slot&quot;</span><span>: </span><span style="font-weight:bold;color:#a71d5d;">func</span><span>(name </span><span style="font-weight:bold;color:#0086b3;">string</span><span>) (template.</span><span style="font-weight:bold;color:#a71d5d;">HTML</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">switch </span><span>name {
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">case </span><span style="color:#183691;">&quot;heading&quot;</span><span>:
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>Render(v.Heading)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">case </span><span style="color:#183691;">&quot;body&quot;</span><span>:
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>Render(v.Body)
</span><span>        </span><span style="font-weight:bold;color:#a71d5d;">default</span><span>:
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.HTML(</span><span style="color:#183691;">&quot;&quot;</span><span>), </span><span style="color:#0086b3;">nil
</span><span>        }
</span><span>    },
</span><span>})
</span></code></pre>










<div>
  <details>
    <summary class="small">
      After refactor (1)
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;48ddc3cce42cbb9337027a7f1df7fd241217ca85">(source: 48ddc3cc)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/render_container_test.go b/render_container_test.go
</span><span>index 951acb3..526d1b8 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_container_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -9,13 +9,30 @@ import (
</span><span> 	. &quot;github.com/stanistan/veun&quot;
</span><span> )
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func slotFuncStub(name string) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> type ContainerView struct {
</span><span> 	Heading Renderable
</span><span> 	Body    Renderable
</span><span> }
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func mustParseTemplate(name, contents string) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return template.Must(
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		template.New(name).
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			Funcs(template.FuncMap{&quot;slot&quot;: slotFuncStub}).
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			Parse(contents),
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">var containerViewTpl = mustParseTemplate(&quot;containerView&quot;, `&lt;div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;heading&quot;&gt;{{ slot &quot;heading&quot; }}&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;body&quot;&gt;{{ slot &quot;body&quot; }}&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">&lt;/div&gt;`)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> func (v ContainerView) Template() (*template.Template, error) {
</span><span style="background-color:#ffecec;color:#323232;">-	return template.New(&quot;containerView&quot;).Funcs(template.FuncMap{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return containerViewTpl.Funcs(template.FuncMap{
</span><span> 		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span> 			switch name {
</span><span> 			case &quot;heading&quot;:
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -26,10 +43,7 @@ func (v ContainerView) Template() (*template.Template, error) {
</span><span> 				return template.HTML(&quot;&quot;), nil
</span><span> 			}
</span><span> 		},
</span><span style="background-color:#ffecec;color:#323232;">-	}).Parse(`&lt;div&gt;
</span><span style="background-color:#ffecec;color:#323232;">-	&lt;div class=&quot;heading&quot;&gt;{{ slot &quot;heading&quot; }}&lt;/div&gt;
</span><span style="background-color:#ffecec;color:#323232;">-	&lt;div class=&quot;body&quot;&gt;{{ slot &quot;body&quot; }}&lt;/div&gt;
</span><span style="background-color:#ffecec;color:#323232;">-&lt;/div&gt;`)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}), nil
</span><span> }
</span><span> 
</span><span> func (v ContainerView) TemplateData() (any, error) {
</span><span>
</span></code></pre>


  </details>
</div>
<p><em>Refactor 2:</em> We can clean up the real slot function so that it
is less brittle when views/slots are added and removed.</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">func </span><span style="font-weight:bold;color:#795da3;">tplWithRealSlotFunc</span><span>(
</span><span>    tpl </span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template</span><span>,
</span><span>    slots </span><span style="font-weight:bold;color:#a71d5d;">map</span><span>[</span><span style="font-weight:bold;color:#0086b3;">string</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>,
</span><span>) </span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template </span><span>{
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>tpl.Funcs(template.FuncMap{
</span><span>        </span><span style="color:#183691;">&quot;slot&quot;</span><span>: </span><span style="font-weight:bold;color:#a71d5d;">func</span><span>(name </span><span style="font-weight:bold;color:#0086b3;">string</span><span>) (template.</span><span style="font-weight:bold;color:#a71d5d;">HTML</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>            slot, ok </span><span style="font-weight:bold;color:#a71d5d;">:= </span><span>slots[name]
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">if </span><span>ok {
</span><span>                </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>Render(slot)
</span><span>            }
</span><span>            </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>template.HTML(</span><span style="color:#183691;">&quot;&quot;</span><span>), </span><span style="color:#0086b3;">nil
</span><span>        },
</span><span>    })
</span><span>}
</span><span>
</span><span style="font-style:italic;color:#969896;">// ... snip ...
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">return </span><span>tplWithRealSlotFunc(containerViewTpl, </span><span style="font-weight:bold;color:#a71d5d;">map</span><span>[</span><span style="font-weight:bold;color:#0086b3;">string</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>{
</span><span>    </span><span style="color:#183691;">&quot;heading&quot;</span><span>: v.Heading,
</span><span>    </span><span style="color:#183691;">&quot;body&quot;</span><span>:    v.Body,
</span><span>}), </span><span style="color:#0086b3;">nil
</span></code></pre>
<p>At this point we've extracted common implementation details but have
kept our main interface the same, which is cool! Our base renderer
doesn't need to know much about anything else, doesn't need to know
about slots, or funcs, or where templates come from.</p>










<div>
  <details>
    <summary class="small">
      after refactor (2)
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;510eb19285474bc41c882a6a4ef9941e9070539c">(source: 510eb192)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/render_container_test.go b/render_container_test.go
</span><span>index 526d1b8..c372d45 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_container_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -31,18 +31,22 @@ var containerViewTpl = mustParseTemplate(&quot;containerView&quot;, `&lt;div&gt;
</span><span> 	&lt;div class=&quot;body&quot;&gt;{{ slot &quot;body&quot; }}&lt;/div&gt;
</span><span> &lt;/div&gt;`)
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func (v ContainerView) Template() (*template.Template, error) {
</span><span style="background-color:#ffecec;color:#323232;">-	return containerViewTpl.Funcs(template.FuncMap{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func tplWithRealSlotFunc(tpl *template.Template, slots map[string]Renderable) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return tpl.Funcs(template.FuncMap{
</span><span> 		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span style="background-color:#ffecec;color:#323232;">-			switch name {
</span><span style="background-color:#ffecec;color:#323232;">-			case &quot;heading&quot;:
</span><span style="background-color:#ffecec;color:#323232;">-				return Render(v.Heading)
</span><span style="background-color:#ffecec;color:#323232;">-			case &quot;body&quot;:
</span><span style="background-color:#ffecec;color:#323232;">-				return Render(v.Body)
</span><span style="background-color:#ffecec;color:#323232;">-			default:
</span><span style="background-color:#ffecec;color:#323232;">-				return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			slot, ok := slots[name]
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			if ok {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">				return Render(slot)
</span><span> 			}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			return template.HTML(&quot;&quot;), nil
</span><span> 		},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	})
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ContainerView) Template() (*template.Template, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return tplWithRealSlotFunc(containerViewTpl, map[string]Renderable{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		&quot;heading&quot;: v.Heading,
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		&quot;body&quot;:    v.Body,
</span><span> 	}), nil
</span><span> }
</span><span> 
</span><span>
</span></code></pre>


  </details>
</div>
<h2 id="a-view">A <code>View{}</code></h2>
<p>This is generally all well and good, we might want to have
something produce a <code>Renderable</code> struct, in fact we might have a
struct that is represents a <code>Renderable</code> object, what if we could
capture the above pattern in a piece of data as well as behavior?</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">type </span><span>View </span><span style="font-weight:bold;color:#a71d5d;">struct </span><span>{
</span><span>    Tpl   </span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template
</span><span>    Slots </span><span style="font-weight:bold;color:#a71d5d;">map</span><span>[</span><span style="font-weight:bold;color:#0086b3;">string</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">Renderable
</span><span>    Data  </span><span style="font-weight:bold;color:#a71d5d;">any
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">func </span><span>(v </span><span style="font-weight:bold;color:#a71d5d;">View</span><span>) </span><span style="font-weight:bold;color:#795da3;">Template</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">*</span><span>template.</span><span style="font-weight:bold;color:#a71d5d;">Template</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>tplWithRealSlotFunc(v.Tpl, v.Slots), </span><span style="color:#0086b3;">nil
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">func </span><span>(v </span><span style="font-weight:bold;color:#a71d5d;">View</span><span>) </span><span style="font-weight:bold;color:#795da3;">TemplateData</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">any</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>v.Data, </span><span style="color:#0086b3;">nil
</span><span>}
</span></code></pre>
<p>The container becomes representable in a different way and it
would have the equivalent outcome when rendered.</p>










<div>
  <details>
    <summary class="small">
      with initial view.go and test
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;745d3ae0d69260b83c0ae50491b7bacd3f37dafe">(source: 745d3ae0)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/render_container_as_view_test.go b/render_container_as_view_test.go
</span><span>new file mode 100644
</span><span>index 0000000..7123b23
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_as_view_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,26 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">package veun_test
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">import (
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;html/template&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;testing&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&quot;github.com/alecthomas/assert/v2&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	. &quot;github.com/stanistan/veun&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func TestRenderContainerAsView(t *testing.T) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	html, err := Render(View{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Tpl: containerViewTpl,
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Slots: map[string]Renderable{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			&quot;heading&quot;: ChildView1{},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			&quot;body&quot;:    ChildView2{},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	})
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	assert.NoError(t, err)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	assert.Equal(t, template.HTML(`&lt;div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;heading&quot;&gt;HEADING&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	&lt;div class=&quot;body&quot;&gt;BODY&lt;/div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">&lt;/div&gt;`), html)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span>diff --git a/render_container_test.go b/render_container_test.go
</span><span>index c372d45..4bc829c 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_container_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -9,24 +9,12 @@ import (
</span><span> 	. &quot;github.com/stanistan/veun&quot;
</span><span> )
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func slotFuncStub(name string) (template.HTML, error) {
</span><span style="background-color:#ffecec;color:#323232;">-	return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#ffecec;color:#323232;">-}
</span><span style="background-color:#ffecec;color:#323232;">-
</span><span> type ContainerView struct {
</span><span> 	Heading Renderable
</span><span> 	Body    Renderable
</span><span> }
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func mustParseTemplate(name, contents string) *template.Template {
</span><span style="background-color:#ffecec;color:#323232;">-	return template.Must(
</span><span style="background-color:#ffecec;color:#323232;">-		template.New(name).
</span><span style="background-color:#ffecec;color:#323232;">-			Funcs(template.FuncMap{&quot;slot&quot;: slotFuncStub}).
</span><span style="background-color:#ffecec;color:#323232;">-			Parse(contents),
</span><span style="background-color:#ffecec;color:#323232;">-	)
</span><span style="background-color:#ffecec;color:#323232;">-}
</span><span style="background-color:#ffecec;color:#323232;">-
</span><span style="background-color:#ffecec;color:#323232;">-var containerViewTpl = mustParseTemplate(&quot;containerView&quot;, `&lt;div&gt;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">var containerViewTpl = MustParseTemplate(&quot;containerView&quot;, `&lt;div&gt;
</span><span> 	&lt;div class=&quot;heading&quot;&gt;{{ slot &quot;heading&quot; }}&lt;/div&gt;
</span><span> 	&lt;div class=&quot;body&quot;&gt;{{ slot &quot;body&quot; }}&lt;/div&gt;
</span><span> &lt;/div&gt;`)
</span><span>diff --git a/view.go b/view.go
</span><span>new file mode 100644
</span><span>index 0000000..ee54469
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/view.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,41 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">package veun
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">import &quot;html/template&quot;
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type View struct {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Tpl   *template.Template
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Slots map[string]Renderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Data  any
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v View) Template() (*template.Template, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return tplWithRealSlotFunc(v.Tpl, v.Slots), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v View) TemplateData() (any, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v.Data, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func tplWithRealSlotFunc(tpl *template.Template, slots map[string]Renderable) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return tpl.Funcs(template.FuncMap{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			slot, ok := slots[name]
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			if ok {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">				return Render(slot)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	})
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func slotFuncStub(name string) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func MustParseTemplate(name, contents string) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return template.Must(
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		template.New(name).
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			Funcs(template.FuncMap{&quot;slot&quot;: slotFuncStub}).
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			Parse(contents),
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span>
</span></code></pre>


  </details>
</div>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span>View{
</span><span>  Tpl: containerViewTpl,
</span><span>  Slots: </span><span style="font-weight:bold;color:#a71d5d;">map</span><span>[</span><span style="font-weight:bold;color:#0086b3;">string</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>{
</span><span>    </span><span style="color:#183691;">&quot;heading&quot;</span><span>: ChildView1{},
</span><span>    </span><span style="color:#183691;">&quot;body&quot;</span><span>:    ChildView2{},
</span><span>  }
</span><span>}
</span></code></pre>
<p>But we still might want to have ContainerView be the thing we can
&quot;render&quot;, how would we do both?</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">type </span><span>AsRenderable </span><span style="font-weight:bold;color:#a71d5d;">interface </span><span>{
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">func </span><span style="font-weight:bold;color:#795da3;">Renderable</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>)
</span><span>}
</span><span>
</span><span style="font-weight:bold;color:#a71d5d;">type </span><span>Slots </span><span style="font-weight:bold;color:#a71d5d;">map</span><span>[</span><span style="font-weight:bold;color:#0086b3;">string</span><span>]</span><span style="font-weight:bold;color:#a71d5d;">AsRenderable
</span></code></pre>










<div>
  <details>
    <summary class="small">
      Renderable and AsRenderable
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;3fb3dcf7e2abacff8a42d8b3da86f85f6576e08e">(source: 3fb3dcf7)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/render_container_as_view_test.go b/render_container_as_view_test.go
</span><span>index 7123b23..a3a0c37 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_container_as_view_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_as_view_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -12,7 +12,7 @@ import (
</span><span> func TestRenderContainerAsView(t *testing.T) {
</span><span> 	html, err := Render(View{
</span><span> 		Tpl: containerViewTpl,
</span><span style="background-color:#ffecec;color:#323232;">-		Slots: map[string]Renderable{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Slots: map[string]AsRenderable{
</span><span> 			&quot;heading&quot;: ChildView1{},
</span><span> 			&quot;body&quot;:    ChildView2{},
</span><span> 		},
</span><span>diff --git a/render_container_test.go b/render_container_test.go
</span><span>index 4bc829c..14dd884 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_container_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -10,8 +10,8 @@ import (
</span><span> )
</span><span> 
</span><span> type ContainerView struct {
</span><span style="background-color:#ffecec;color:#323232;">-	Heading Renderable
</span><span style="background-color:#ffecec;color:#323232;">-	Body    Renderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Heading AsRenderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Body    AsRenderable
</span><span> }
</span><span> 
</span><span> var containerViewTpl = MustParseTemplate(&quot;containerView&quot;, `&lt;div&gt;
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -19,7 +19,7 @@ var containerViewTpl = MustParseTemplate(&quot;containerView&quot;, `&lt;div&gt;
</span><span> 	&lt;div class=&quot;body&quot;&gt;{{ slot &quot;body&quot; }}&lt;/div&gt;
</span><span> &lt;/div&gt;`)
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func tplWithRealSlotFunc(tpl *template.Template, slots map[string]Renderable) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func tplWithRealSlotFunc(tpl *template.Template, slots map[string]AsRenderable) *template.Template {
</span><span> 	return tpl.Funcs(template.FuncMap{
</span><span> 		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span> 			slot, ok := slots[name]
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -32,7 +32,7 @@ func tplWithRealSlotFunc(tpl *template.Template, slots map[string]Renderable) *t
</span><span> }
</span><span> 
</span><span> func (v ContainerView) Template() (*template.Template, error) {
</span><span style="background-color:#ffecec;color:#323232;">-	return tplWithRealSlotFunc(containerViewTpl, map[string]Renderable{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return tplWithRealSlotFunc(containerViewTpl, map[string]AsRenderable{
</span><span> 		&quot;heading&quot;: v.Heading,
</span><span> 		&quot;body&quot;:    v.Body,
</span><span> 	}), nil
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -42,12 +42,20 @@ func (v ContainerView) TemplateData() (any, error) {
</span><span> 	return nil, nil
</span><span> }
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ContainerView) Renderable() (Renderable, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> var childViewTemplate = template.Must(
</span><span> 	template.New(&quot;childView&quot;).Parse(`{{ . }}`),
</span><span> )
</span><span> 
</span><span> type ChildView1 struct{}
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ChildView1) Renderable() (Renderable, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> func (v ChildView1) Template() (*template.Template, error) {
</span><span> 	return childViewTemplate, nil
</span><span> }
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -66,6 +74,10 @@ func (v ChildView2) TemplateData() (any, error) {
</span><span> 	return &quot;BODY&quot;, nil
</span><span> }
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ChildView2) Renderable() (Renderable, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> func TestRenderContainer(t *testing.T) {
</span><span> 	html, err := Render(&amp;ContainerView{
</span><span> 		Heading: ChildView1{},
</span><span>diff --git a/render_person_test.go b/render_person_test.go
</span><span>index 64a542b..80ef587 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_person_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_person_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -34,6 +34,10 @@ func (v *personView) TemplateData() (any, error) {
</span><span> 	return v.Person, nil
</span><span> }
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v *personView) Renderable() (veun.Renderable, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> func TestRenderPerson(t *testing.T) {
</span><span> 	html, err := veun.Render(PersonView(Person{Name: &quot;Stan&quot;}))
</span><span> 	assert.NoError(t, err)
</span><span>diff --git a/renderer.go b/renderer.go
</span><span>index c96d89d..cb2c5f0 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/renderer.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/renderer.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -6,14 +6,25 @@ import (
</span><span> 	&quot;html/template&quot;
</span><span> )
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-type RenderFunc func(r Renderable) (template.HTML, error)
</span><span style="background-color:#ffecec;color:#323232;">-
</span><span> type Renderable interface {
</span><span> 	Template() (*template.Template, error)
</span><span> 	TemplateData() (any, error)
</span><span> }
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func Render(r Renderable) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type AsRenderable interface {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Renderable() (Renderable, error)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func Render(r AsRenderable) (template.HTML, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	rr, err := r.Renderable()
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	if err != nil {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		return template.HTML(&quot;&quot;), err
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return render(rr)
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func render(r Renderable) (template.HTML, error) {
</span><span> 	var empty template.HTML
</span><span> 
</span><span> 	tpl, err := r.Template()
</span><span>diff --git a/view.go b/view.go
</span><span>index ee54469..bb33a3d 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/view.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/view.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -4,7 +4,7 @@ import &quot;html/template&quot;
</span><span> 
</span><span> type View struct {
</span><span> 	Tpl   *template.Template
</span><span style="background-color:#ffecec;color:#323232;">-	Slots map[string]Renderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Slots map[string]AsRenderable
</span><span> 	Data  any
</span><span> }
</span><span> 
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -16,7 +16,11 @@ func (v View) TemplateData() (any, error) {
</span><span> 	return v.Data, nil
</span><span> }
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func tplWithRealSlotFunc(tpl *template.Template, slots map[string]Renderable) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v View) Renderable() (Renderable, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return v, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func tplWithRealSlotFunc(tpl *template.Template, slots map[string]AsRenderable) *template.Template {
</span><span> 	return tpl.Funcs(template.FuncMap{
</span><span> 		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span> 			slot, ok := slots[name]
</span><span>
</span></code></pre>


  </details>
</div>
<p>And updating the <code>Render</code> function for the first time to take
<code>AsRenderable</code> instead gives us our first really big interface
change, but it unlocks something, too. A simpler way to build views:</p>
<pre data-lang="go" style="background-color:#ffffff;color:#323232;" class="language-go "><code class="language-go" data-lang="go"><span style="font-weight:bold;color:#a71d5d;">func </span><span>(v </span><span style="font-weight:bold;color:#a71d5d;">ContainerView</span><span>) </span><span style="font-weight:bold;color:#795da3;">Renderable</span><span>() (</span><span style="font-weight:bold;color:#a71d5d;">Renderable</span><span>, </span><span style="font-weight:bold;color:#0086b3;">error</span><span>) {
</span><span>    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span>View{
</span><span>        Tpl:   containerViewTpl,
</span><span>        Slots: Slots{</span><span style="color:#183691;">&quot;heading&quot;</span><span>: v.Heading, </span><span style="color:#183691;">&quot;body&quot;</span><span>: v.Body},
</span><span>    ), </span><span style="color:#0086b3;">nil
</span><span>}
</span></code></pre>










<div>
  <details>
    <summary class="small">
      with Slot map[string]AsRenderable
      <a href="https:&#x2F;&#x2F;github.com&#x2F;stanistan&#x2F;veun&#x2F;commit&#x2F;6c5721832cd6597b9cb0d255dc5fb9daf68a42ef">(source: 6c572183)</a>
    </summary>

<pre data-lang="patch" style="background-color:#ffffff;color:#323232;" class="language-patch "><code class="language-patch" data-lang="patch"><span>diff --git a/render_container_as_view_test.go b/render_container_as_view_test.go
</span><span>index a3a0c37..9af1ad0 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/render_container_as_view_test.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/render_container_as_view_test.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -9,13 +9,22 @@ import (
</span><span> 	. &quot;github.com/stanistan/veun&quot;
</span><span> )
</span><span> 
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type ContainerView2 struct {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Heading AsRenderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	Body    AsRenderable
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func (v ContainerView2) Renderable() (Renderable, error) {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	return View{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Tpl:   containerViewTpl,
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Slots: Slots{&quot;heading&quot;: v.Heading, &quot;body&quot;: v.Body},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	}, nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">}
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span> func TestRenderContainerAsView(t *testing.T) {
</span><span style="background-color:#ffecec;color:#323232;">-	html, err := Render(View{
</span><span style="background-color:#ffecec;color:#323232;">-		Tpl: containerViewTpl,
</span><span style="background-color:#ffecec;color:#323232;">-		Slots: map[string]AsRenderable{
</span><span style="background-color:#ffecec;color:#323232;">-			&quot;heading&quot;: ChildView1{},
</span><span style="background-color:#ffecec;color:#323232;">-			&quot;body&quot;:    ChildView2{},
</span><span style="background-color:#ffecec;color:#323232;">-		},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	html, err := Render(ContainerView2{
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Heading: ChildView1{},
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">		Body:    ChildView2{},
</span><span> 	})
</span><span> 	assert.NoError(t, err)
</span><span> 	assert.Equal(t, template.HTML(`&lt;div&gt;
</span><span>diff --git a/slots.go b/slots.go
</span><span>new file mode 100644
</span><span>index 0000000..974792e
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> /dev/null
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/slots.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -0,0 +1,3 @@
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">package veun
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">type Slots map[string]AsRenderable
</span><span>diff --git a/view.go b/view.go
</span><span>index bb33a3d..11b2da6 100644
</span><span style="background-color:#ffecec;font-weight:bold;font-style:italic;color:#bd2c00;">---</span><span style="font-style:italic;color:#969896;"> a/view.go
</span><span style="background-color:#eaffea;font-weight:bold;font-style:italic;color:#55a532;">+++</span><span style="font-style:italic;color:#969896;"> b/view.go
</span><span style="font-weight:bold;font-style:italic;color:#969896;">@@ -20,14 +20,19 @@ func (v View) Renderable() (Renderable, error) {
</span><span> 	return v, nil
</span><span> }
</span><span> 
</span><span style="background-color:#ffecec;color:#323232;">-func tplWithRealSlotFunc(tpl *template.Template, slots map[string]AsRenderable) *template.Template {
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">func tplWithRealSlotFunc(
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	tpl *template.Template,
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">	slots map[string]AsRenderable,
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">) *template.Template {
</span><span> 	return tpl.Funcs(template.FuncMap{
</span><span> 		&quot;slot&quot;: func(name string) (template.HTML, error) {
</span><span> 			slot, ok := slots[name]
</span><span> 			if ok {
</span><span> 				return Render(slot)
</span><span> 			}
</span><span style="background-color:#ffecec;color:#323232;">-			return template.HTML(&quot;&quot;), nil
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			var empty template.HTML
</span><span style="background-color:#eaffea;font-weight:bold;color:#55a532;">+</span><span style="background-color:#eaffea;color:#323232;">			return empty, nil
</span><span> 		},
</span><span> 	})
</span><span> }
</span><span>
</span></code></pre>


  </details>
</div>
<hr />
<h3 id="next">Next:</h3>
<ul>
<li><a href="/writes/building-view-trees-in-go-part-3">Error handling</a></li>
<li><a href="/writes/building-view-trees-in-go-part-4">Async data fetching</a></li>
<li><a href="/writes/building-view-trees-in-go-part-5">http.Handler</a></li>
<li><a href="/writes/building-view-trees-in-go-part-6">Updating the base interface</a></li>
</ul>

        </section>

        

    </article>

            
        </div>
    </body>
</html>
